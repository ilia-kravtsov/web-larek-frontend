# Проектная работа "Веб-ларек"

[Открыть проект](https://ilia-kravtsov.github.io/web-larek-frontend/)

## Общая структура и архитектура проектной работы:  
```
Проект разработан с использованием архитектуры Model-View-Presenter (MVP),    
обеспечивающей распределение ответственности между слоями:  
• данных (model),  
• отображения (view)  
• логики взаимодействия между model и view (presenter).  

Такое распределение упрощает поддержку и масштабирование проекта, а также делает его структуру более понятной и модульной.  
• model — отвечает за загрузку данных реализуя логику запросов API, их обработку и хранение.  
• view — обеспечивает отображение пользовательского интерфейса.  
• presenter — выступает связующим звеном между model и view, обрабатывая события и координируя логику приложения.  
```
### Преимущества использования MVP  
```
• Модульность — каждый слой отвечает за строго определённые задачи, что упрощает отладку.  
• Гибкость — логику взаимодействия (Presenter) можно легко изменять или расширять, не затрагивая другие слои.  
• Масштабируемость — благодаря чёткому разделению, в проект легче добавлять новую функциональность  
```
## Стек:   
```
• HTML  
• SCSS  
• JS&TS  
• Webpack  
```
## Структура проекта:  
```
• src/ — исходные файлы проекта  
• src/components/ — папка с JS компонентами  
• src/components/base/ — папка с базовым кодом  
• src/components/base/api.ts — содержит класс Api, который служит основой для реализации зарпосов в слое model.  
• src/components/base/events.ts — содержит класс EventEmitter, который выступает в роли Presenter.  
• src/components/model/ — здесь содержатся сервисы для работы с данными, реализующие слой Model.   
  Эти сервисы взаимодействуют с API, управляют данными и предоставляют их для других частей приложения.  
• src/components/view/ — здесь содержатся компоненты пользовательского интерфейса (UI), которые реализуют слой View.   
  Эти компоненты отвечают за визуализацию данных, взаимодействие с пользователем   
  и передачу событий в слой Presenter используя EventEmitter.  
```

## Важные файлы:
```
• src/pages/index.html — HTML-файл главной страницы  
• src/types/index.ts — файл с типами  
• src/index.ts — точка входа приложения  
• src/scss/styles.scss — корневой файл стилей  
• src/utils/constants.ts — файл с константами  
• src/utils/utils.ts — файл с утилитами  
```
## Описание базовых классов

### Api
```
• Класс Api предназначен для реализации логики HTTP запросов от клиента к серверу.   
  Он предоставляет методы для выполнения различных типов запросов (GET, POST), а также обработку ответов от сервера.  

Свойства:  
• baseUrl: string — базовый URL для всех запросов, используется в комбинации с URI, передаваемыми в методы.  
• options: RequestInit — параметры запроса, включая заголовки и другие настройки.  

Методы:  
• constructor — конструктор класса, инициализирует объект с базовым URL и опциями запроса.   
  Заголовки по умолчанию устанавливаются как Content-Type: application/json.  
• handleResponse — защищённый метод для обработки ответа сервера.   
  Если ответ успешный, он преобразует его в JSON и возвращает в виде промиса.   
  В случае ошибки — возвращает ошибку, которая может быть получена из тела ответа.  
• get — метод для выполнения HTTP GET запроса. Принимает часть URL и возвращает промис с результатом выполнения запроса   
  в виде объекта типа T.  
• post — метод для выполнения HTTP POST запроса. Принимает URI, данные для отправки на сервер и тип HTTP-метода.   
  Возвращает промис с результатом выполнения запроса.  
```
### EventEmitter
```
• Класс EventEmitter представляет собой брокер событий, реализующий подписку на события. 
  Он позволяет отслеживать события в приложении и уведомлять об изменениях через систему подписок.

Типы:
• EventName — тип для имени события. Может быть строкой или регулярным выражением.
• Subscriber — тип для обработчика события, который является функцией.
• EmitterEvent — объект, представляющий событие с данными, содержащий имя события и данные.

Интерфейс IEvents:
• Интерфейс, который описывает базовый функционал для работы с событиями. Включает методы:
• on<T>(event: EventName, callback: (data: T) => void): void — подписка на событие.
• emit<T>(event: string, data?: T): void — эмиссия события. 
  (Эмиссия — инициирование или "вызов" события, которое затем может быть обработано одним или несколькими подписчиками 
  (обработчиками события))
• trigger<T>(event: string, context?: Partial<T>): (data: T) => void — создание функции-триггера, генерирующей событие.

Свойства:
• _events: Map<EventName, Set<Subscriber>> — объект, хранящий события и их подписчиков. 
  Каждое событие сопоставляется с набором обработчиков.

Методы:
• constructor() — инициализирует объект EventEmitter и создаёт пустой объект для хранения событий и подписчиков.
• on — метод для подписки на событие. Принимает имя события и обработчик, который будет вызван при его эмиссии. 
  Если событие ещё не зарегистрировано, оно создаётся в объекте.
• off — метод для отмены подписки. Удаляет указанный обработчик с события. 
  Если для события больше не осталось обработчиков, оно удаляется из объекта.
• emit — метод для эмиссии события. Принимает имя события и данные, 
  которые будут переданы всем подписчикам этого события.
• onAll — метод для подписки на все события. Используется специальное событие с именем '*', 
  которое позволяет отслеживать все эмитируемые события.
• offAll — метод для сброса всех подписчиков. Очищает все события и обработчики.
• trigger — метод для создания триггера — функции, которая при вызове инициирует событие с переданными данными. 
  Это позволяет динамически генерировать события в коде.
```
## Описание классов реализующих слой model
```
• Классы слоя Model обеспечивающие взаимодействие с сервером, хранение и обработку данных, 
  а также предоставляющие удобные методы для работы с данными пользователя и приложения.
```
### ApiService
```
• ApiService — реализует наследование от класса Api и предназначен для реализации конкретных API-запросов, 
  используемых в проекте. Этот класс является частью слоя Model и обеспечивает взаимодействие с сервером.

Методы:
• getProductList — запрашивает список товаров с сервера, возвращает объект, 
  содержащий общее количество продуктов (total) и массив продуктов (items).
  Обрабатывает каждую запись в массиве, добавляя к полю image полный URL изображения с помощью метода resolveImageUrl.
• resolveImageUrl (приватный метод) — дополняет путь к изображению базовым URL из cdn, если путь не является абсолютным.
  Обеспечивает корректную работу с изображениями как локальными, так и внешними.
• postOrderRequest — отправляет данные заказа (orderData) на сервер по пути /order методом POST.
  возвращает успешный ответ от сервера с общей суммой заказа total и id (IOrderSuccess).
```
### BasketService
```
• BasketService реализует интерфейс IBasketService и управляет корзиной товаров в приложении, 
  предоставляя методы для работы с её содержимым.

Методы:
• getProductCount — возвращает общее количество товаров в корзине.
• getTotalPrice — подсчитывает и возвращает общую стоимость всех товаров в корзине.
• addProduct — добавляет продукт в корзину, если его ещё нет.
• removeProduct — удаляет указанный продукт из корзины, если он присутствует.
• clear — полностью очищает корзину, удаляя все товары.

Геттеры и сеттеры:
• products: Позволяет получить или установить список товаров в корзине.
```
### DataService
```
• DataService реализует интерфейс IDataService и отвечает за управление данными о товарах, 
  а также взаимодействует с системой событий через IEvents.

Методы:
• modalWindowProduct — устанавливает выбранный продукт для модального окна и вызывает событие modalWindow:open, 
  передавая данные о товаре.

Геттеры и сеттеры:
• set products — возвращает текущий список продуктов.
• get products — устанавливает новый список продуктов и инициирует событие products:received.
```
### OrderService
```
• Класс OrderService реализует интерфейсы IOrderServiceMethods и IOrderRequest. 
  Он управляет данными заказа, включая адрес, контактную информацию, способ оплаты, 
  а также выполняет валидацию и генерацию данных для отправки.

Методы:
• setAddress — устанавливает значение адреса. 
  Если валидация заказа успешна, вызывает событие order:completed с обновлёнными данными заказа.
• validateOrder — выполняет проверку адреса и способа оплаты. 
  Если валидация не проходит, заполняет объект ошибок errors и генерирует событие orderError:address&paymentMethod.
• setContactData — устанавливает контактные данные (email или телефон). 
  Если валидация успешна, вызывает событие order:completed.
• validateContacts — проверяет корректность email и телефона. 
  Обновляет объект ошибок и генерирует событие orderError:isValid.
• updateOrderData — возвращает объект с текущими данными заказа, включая адрес, контакты, способ оплаты, сумму и товары.

Приватные методы:
• isValidPayment — проверяет, является ли способ оплаты допустимым (наличные или карта).
• isValidAddress — проверяет валидность адреса с использованием регулярного выражения.
• validateEmail — проверяет корректность email и добавляет ошибку в объект errors, если email некорректен.
• validatePhone — проверяет корректность номера телефона и добавляет ошибку в объект errors, если номер некорректен. 
  Если телефон начинается с "8", преобразует его в международный формат.
• isFormValid — проверяет, отсутствуют ли ошибки валидации.

Свойства:
• payment, email, phone, address — данные о заказе.
• total — общая сумма заказа.
• items — массив идентификаторов товаров.
• errors — объект, хранящий ошибки валидации.
```
## Описание классов реализующих слой view
```
• Классы слоя View, отвечающие за отображение пользовательского интерфейса, обработку взаимодействий c пользователем 
  и вызовы соответствующих методов Presenter для обновления данных и интерфейса.
```
### Basket
```
• Класс Basket реализует интерфейс IBasket, предоставляя функционал для управления и отображения содержимого корзины, 
  а также взаимодействия с пользователем через события.

Методы:
• set items — обновляет список элементов в корзине:
  • Если корзина не пуста, заменяет содержимое списка новыми элементами и активирует кнопку оформления заказа.
  • Если корзина пуста, отключает кнопку оформления заказа и добавляет сообщение "Корзина пуста".
• updateHeaderCounter — обновляет счетчик товаров корзины в заголовке интерфейса, устанавливая новое значение.
• updateTotalPrice — обновляет общую стоимость товаров в корзине, добавляя текст с указанием цены в "синапсах".
• render — устанавливает заголовок корзины и возвращает контейнер с её содержимым для отображения.
```
### BasketProduct
```
• Класс BasketProduct отвечает за создание и отображение товаров в корзине. 
  Он позволяет отобразить информацию о товаре (название, цена, индекс в списке) 
  и предоставить возможность удалить товар из корзины через кнопку.

Методы:
• private removeButton — добавляет обработчик события для кнопки удаления, 
  используя метод onClick из объекта actions, если он передан.
• private formatPrice — форматирует цену товара для отображения:
  Если значение цены равно null, возвращает строку "Бесценно".
  Иначе добавляет к цене суффикс "синапсов".
• render — отображает элемент товара в корзине:
  Устанавливает индекс товара в списке.
  Задает название и цену товара.
  Возвращает готовый DOM-элемент для вставки в корзину.

Свойства:
• basketItem — контейнер элемента корзины.
• indexElement — элемент для отображения индекса товара.
• titleElement — элемент для отображения названия товара.
• priceElement — элемент для отображения цены товара.
• deleteButton — кнопка для удаления товара из корзины.
```
### Card
```
• Класс Card предназначен для отображения карточки товара на странице. 
  Он динамически обновляет содержимое карточки на основе переданных данных о товаре 
  и предоставляет возможность добавления пользовательских действий, таких как клик.

Методы:
• protected setTextContent — устанавливает текстовое содержимое для указанного элемента, если он существует.
• protected setPrice — форматирует цену товара:
  Возвращает строку "Бесценно", если цена равна null.
  Иначе возвращает строку с ценой и суффиксом "синапсов".
• protected updateCategoryElement — обновляет текст и класс элемента категории товара:
  Устанавливает текст категории.
  Добавляет CSS-класс в зависимости от категории (например, "card__category_hard").
• protected updateCardElements — обновляет содержимое всех элементов карточки:
  Категория, название, изображение, цена.
  Изображению задаются атрибуты src и alt на основе данных товара.
• render — создает и возвращает DOM-элемент карточки с обновленным содержимым, используя данные о товаре.

Свойства:
• _colors: объект, связывающий категории товаров с CSS-классами. Например, "хард-скил" → "hard".
• _cardElement: корневой элемент карточки.
• _categoryElement: элемент для отображения категории.
• _titleElement: элемент для отображения названия.
• _imageElement: элемент для отображения изображения.
• _priceElement: элемент для отображения цены.
```
### CardDetails
```
• Класс CardDetails предназначен для отображения подробной информации о товаре, включая описание и кнопку действия. 
  Он обновляет элементы карточки с данными о товаре и предоставляет функциональность для добавления товара в корзину.

Методы:
• private initializeEventListeners — настраивает обработчик события для кнопки действия. 
  При клике на кнопку генерируется событие 'product:addToBasket'. 
• private getActionButtonText — определяет текст кнопки в зависимости от наличия цены у товара. 
  Если цена есть, кнопка отображает текст "Купить", если нет — кнопка отключается и текст меняется на "Не продается". 
• render — обновляет элементы карточки товара, включая описание и текст кнопки действия, 
  и возвращает обновленный DOM-элемент карточки.

Свойства: 
• descriptionElement — элемент для отображения описания товара. 
• actionButton — кнопка действия, которая позволяет добавить товар в корзину. 
• events — объект для управления событиями, используемый для отправки события при нажатии на кнопку. 
• _cardElement — корневой элемент карточки.
```
### Contacts
```
• Класс Contacts предназначен для управления формой обратной связи. 
  Он обрабатывает ввод данных пользователем и отправку формы, 
  а также управляет состоянием кнопки отправки в зависимости от валидности формы.

Методы:
• set isValid — устанавливает состояние кнопки отправки формы. 
  Если значение true, кнопка активируется, если false — кнопка отключается. 
• render — возвращает DOM-элемент формы, готовый к отображению. 
• private attachInputListeners — настраивает обработчики событий для полей ввода. 
  При изменении значения в поле отправляется событие 'contacts:inputChange'. 
• private attachFormSubmitListener — добавляет обработчик события отправки формы, 
  который предотвращает стандартное поведение и вызывает событие 'renderSuccessWindow:open'.

Свойства:
• form — элемент формы для ввода данных. 
• inputs — массив элементов ввода (поля формы). 
• submitButton — кнопка отправки формы. 
• errorMessages — элемент для отображения сообщений об ошибках. 
• events — объект для управления событиями.
```
### ModalWindow
```
• Класс ModalWindow предназначен для управления модальным окном на странице. 
  Он позволяет отображать и скрывать окно, а также изменять его содержимое. 
  Также управляет состоянием страницы, блокируя или разблокируя ее при открытии окна.

Методы:
• setContent — заменяет содержимое модального окна на переданный элемент. 
• show — отображает модальное окно, добавляя класс 'modal_active', и генерирует событие 'modal:open'. 
• hide — скрывает модальное окно, удаляя класс 'modal_active', очищает содержимое и генерирует событие 'modal:close'. 
• private clearContent — очищает содержимое модального окна. 
• render — отображает модальное окно, вызывая метод show и возвращает DOM-элемент контейнера модального окна.

Свойства:
• container: контейнер модального окна. 
• closeButton: кнопка закрытия модального окна. 
• content: элемент для отображения содержимого модального окна. 
• wrapper: обертка страницы, на которую накладывается блокировка (locked). 
• events: объект для управления событиями.
• isLocked: управляет блокировкой страницы при отображении модального окна, добавляя/удаляя класс 'page__wrapper_locked'
```
### Order
```
• Класс Order предназначен для управления формой оформления заказа, включая выбор метода оплаты, 
  ввод данных и отправку формы. Он позволяет переключать методы оплаты, 
  а также управлять состоянием кнопки отправки в зависимости от валидности данных.

Методы: 
• set paymentMethod — устанавливает выбранный метод оплаты, активируя соответствующую кнопку и деактивируя остальные. 
• set isValid — устанавливает состояние кнопки отправки формы. 
  Если значение true, кнопка активируется, если false — кнопка отключается. 
• render — возвращает DOM-элемент формы, готовый к отображению.

Свойства: 
• form — элемент формы оформления заказа. 
• buttons — массив кнопок, отвечающих за выбор метода оплаты. 
• submitButton — кнопка отправки формы. 
• errorMessages — элемент для отображения сообщений об ошибках. 
• paymentMethod — выбранный метод оплаты (передается через кнопки выбора). 
• events — объект для управления событиями.
```
### RenderSuccessWindow
```
• Класс RenderSuccessWindow предназначен для отображения успешного завершения оформления заказа. 
  Он обновляет содержимое окна с информацией о списанных средствах и предоставляет кнопку для закрытия окна.

Методы: 
• private initEventListeners — настраивает обработчик события для кнопки закрытия окна. 
  При клике генерируется событие 'renderSuccessWindow:close'. 
• render — обновляет описание в окне, отображая информацию о списанных средствах, 
  и возвращает DOM-элемент окна успешной операции.

Свойства: 
• success — элемент окна успешной операции. 
• description — элемент для отображения описания (информации о списанных средствах). 
• button — кнопка закрытия окна. 
• events — объект для управления событиями.
```
## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```
